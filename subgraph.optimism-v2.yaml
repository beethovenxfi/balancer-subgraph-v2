specVersion: 0.0.4
description: Beethoven X is a non-custodial portfolio manager, liquidity provider, and price sensor.
repository: https://github.com/beethovenxfi/balancer-subgraph-v2
#features:
#  - grafting
schema:
  file: ./schema.graphql
#graft:
#  base: QmYLUByT8L994z5g9eQvECdzggR1Stw2EWZUFXtaM9muzd
#  block: 28893627
dataSources:
  - kind: ethereum/contract
    name: Vault
    network: optimism
    source:
      address: '0xBA12222222228d8Ba445958a75a0704d566BF2C8'
      abi: Vault
      startBlock: 6000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/vault.ts
      entities:
        - Balancer
        - VaultToken
        - LifetimeVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - GradualSwapFeeUpdate
        - StablePoolData
        - LinearPoolData
        - LinearPoolTarget
        - LiquidityBootstrappingPoolData
        - TokenWeight
        - LifetimePoolMetric
        - DailyPoolMetric
        - Amp
        - GradualAmpUpdate
        - GradualWeightUpdate
        - Token
        - PoolShares
        - User
        - UserInternalBalance
        - TokenPrice
        - PriceRateProider
        - PoolJoin
        - PoolExit
        - Swap
        - DailyPoolToken
        - DailyVaultToken
        - HourlyTokenPrice
      abis:
        - name: Vault
          file: ./abis/Vault.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: StablePool
          file: ./abis/StablePool.json
      eventHandlers:
        - event: Swap(indexed bytes32,indexed address,indexed address,uint256,uint256)
          handler: handleSwapEvent
        - event: PoolBalanceChanged(indexed bytes32,indexed address,address[],int256[],uint256[])
          handler: handleBalanceChange
        - event: PoolBalanceManaged(indexed bytes32,indexed address,indexed address,int256,int256)
          handler: handleBalanceManage
        - event: InternalBalanceChanged(indexed address,indexed address,int256)
          handler: handleInternalBalanceChange
  - kind: ethereum/contract
    name: WeightedPoolFactory
    network: optimism
    source:
      address: '0xdAE7e32ADc5d490a43cCba1f0c736033F2b4eFca'
      abi: WeightedPoolFactory
      startBlock: 6000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolFactory.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
      abis:
        - name: Vault
          file: ./abis/Vault.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WeightedPoolFactory
          file: ./abis/WeightedPoolFactory.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
      eventHandlers:
        - event: PoolCreated(indexed address)
          handler: handleNewWeightedPool
  - kind: ethereum/contract
    name: WeightedPool2TokenFactory
    network: optimism
    source:
      address: '0x0F3e0c4218b7b0108a3643cFe9D3ec0d4F57c54e'
      abi: WeightedPoolFactory
      startBlock: 6000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolFactory.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
      abis:
        - name: Vault
          file: ./abis/Vault.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WeightedPoolFactory
          file: ./abis/WeightedPoolFactory.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
      eventHandlers:
        - event: PoolCreated(indexed address)
          handler: handleNewWeightedPool
  - kind: ethereum/contract
    name: StablePoolFactory
    network: optimism
    source:
      address: '0x41B953164995c11C81DA73D212ED8Af25741b7Ac'
      abi: StablePoolFactory
      startBlock: 6000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolFactory.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - StablePoolData
        - Amp
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - GlobalPoolMetric
        - Token
      abis:
        - name: Vault
          file: ./abis/Vault.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: StablePoolFactory
          file: ./abis/StablePoolFactory.json
        - name: StablePool
          file: ./abis/StablePool.json
      eventHandlers:
        - event: PoolCreated(indexed address)
          handler: handleNewStablePool
  - kind: ethereum/contract
    name: MetaStablePoolFactory
    network: optimism
    source:
      address: '0xb08E16cFc07C684dAA2f93C70323BAdb2A6CBFd2'
      abi: MetaStablePoolFactory
      startBlock: 6000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolFactory.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - StablePoolData
        - Amp
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - GlobalPoolMetric
        - Token
      abis:
        - name: Vault
          file: ./abis/Vault.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: MetaStablePoolFactory
          file: ./abis/MetaStablePoolFactory.json
        - name: StablePool
          file: ./abis/StablePool.json
        - name: MetaStablePool
          file: ./abis/MetaStablePool.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
      eventHandlers:
        - event: PoolCreated(indexed address)
          handler: handleNewMetaStablePool
  - kind: ethereum/contract
    name: LiquidityBootstrappingPoolFactory
    network: optimism
    source:
      address: '0xf302f9F50958c5593770FDf4d4812309fF77414f'
      abi: LiquidityBootstrappingPoolFactory
      startBlock: 6000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolFactory.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - Amp
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
      abis:
        - name: Vault
          file: ./abis/Vault.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: LiquidityBootstrappingPoolFactory
          file: ./abis/LiquidityBootstrappingPoolFactory.json
        - name: LiquidityBootstrappingPool
          file: ./abis/LiquidityBootstrappingPool.json
      eventHandlers:
        - event: PoolCreated(indexed address)
          handler: handleNewLiquidityBootstrappingPool
#  - kind: ethereum/contract
#    name: StablePhantomPoolFactory
#    network: optimism
#    source:
#      address: '0x0E2AFa0b5F9174750d4E84Bf9798f89b79Bd5bF4'
#      abi: StablePhantomPoolFactory
#      startBlock: 28658437
#    mapping:
#      kind: ethereum/events
#      apiVersion: 0.0.6
#      language: wasm/assemblyscript
#      file: ./src/mappings/poolFactory.ts
#      entities:
#        - Balancer
#        - GlobalVaultMetric
#        - Pool
#        - StablePoolData
#        - Amp
#        - PoolToken
#        - PoolAddressToId
#        - SwapConfig
#        - GlobalPoolMetric
#        - Token
#      abis:
#        - name: Vault
#          file: ./abis/Vault.json
#        - name: ERC20
#          file: ./abis/ERC20.json
#        - name: WeightedPool
#          file: ./abis/WeightedPool.json
#        - name: StablePhantomPoolFactory
#          file: ./abis/StablePhantomPoolFactory.json
#        - name: StablePool
#          file: ./abis/StablePool.json
#        - name: StablePhantomPool
#          file: ./abis/StablePhantomPool.json
#      eventHandlers:
#        - event: PoolCreated(indexed address)
#          handler: handleNewStablePhantomPool
  - kind: ethereum/contract
    name: ChildChainLiquidityGaugeFactory
    # prettier-ignore
    network: optimism
    source:
      address: '0x2E96068b3D5B5BAE3D7515da4A1D2E52d08A2647'
      abi: ChildChainLiquidityGaugeFactory
      # prettier-ignore
      startBlock: 9112420
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/gauge-emissions.ts
      abis:
        - name: ChildChainLiquidityGaugeFactory
          file: ./abis/ChildChainLiquidityGaugeFactory.json
        - name: RewardsOnlyGauge
          file: ./abis/RewardsOnlyGauge.json
        - name: LiquidityGauge
          file: ./abis/LiquidityGaugeV5.json
        - name: WeightedPool
          file: ./abis/WeightedPool.json
      entities:
        - Farm
        - StakedPoolShares
        - LifetimeFarmMetric
        - DailyFarmMetric
        - GaugeStreamer
        - GaugeEmissionProvider
        - GaugeChefRewardToken
        - ClaimedEmission
        - StakedPoolShares
      eventHandlers:
        - event: RewardsOnlyGaugeCreated(indexed address,indexed address,address)
          handler: handleRewardsOnlyGaugeCreated
templates:
  - kind: ethereum/contract
    name: WeightedPool
    network: optimism
    source:
      abi: WeightedPool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolController.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
        - PoolShares
        - UserShare
      abis:
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: BalancerPoolToken
          file: ./abis/BalancerPoolToken.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: SwapFeePercentageChanged(uint256)
          handler: handleSwapFeePercentageChange
  - kind: ethereum/contract
    name: StablePool
    network: optimism
    source:
      abi: StablePool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolController.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
        - PoolShares
        - UserShare
        - Amp
        - GradualAmpUpdate
      abis:
        - name: WeightedPool # Necessary for Transfer handler
          file: ./abis/WeightedPool.json
        - name: StablePool
          file: ./abis/StablePool.json
        - name: BalancerPoolToken
          file: ./abis/BalancerPoolToken.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: SwapFeePercentageChanged(uint256)
          handler: handleSwapFeePercentageChange
        - event: AmpUpdateStarted(uint256,uint256,uint256,uint256)
          handler: handleAmpUpdateStarted
        - event: AmpUpdateStopped(uint256)
          handler: handleAmpUpdateStopped
  - kind: ethereum/contract
    name: MetaStablePool
    network: optimism
    source:
      abi: MetaStablePool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolController.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
        - PoolShares
        - UserShare
        - Amp
        - GradualAmpUpdate
        - PriceRateProvider
      abis:
        - name: WeightedPool # Necessary for Transfer handler
          file: ./abis/WeightedPool.json
        - name: StablePool
          file: ./abis/StablePool.json
        - name: MetaStablePool
          file: ./abis/MetaStablePool.json
        - name: BalancerPoolToken
          file: ./abis/BalancerPoolToken.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: SwapFeePercentageChanged(uint256)
          handler: handleSwapFeePercentageChange
        - event: AmpUpdateStarted(uint256,uint256,uint256,uint256)
          handler: handleAmpUpdateStarted
        - event: AmpUpdateStopped(uint256)
          handler: handleAmpUpdateStopped
        - event: PriceRateProviderSet(indexed address,indexed address,uint256)
          handler: handlePriceRateProviderSet
        - event: PriceRateCacheUpdated(indexed address,uint256)
          handler: handlePriceRateCacheUpdated
  - kind: ethereum/contract
    name: LiquidityBootstrappingPool
    network: optimism
    source:
      abi: LiquidityBootstrappingPool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolController.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
        - PoolShares
        - UserShare
        - GradualWeightUpdate
      abis:
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: LiquidityBootstrappingPool
          file: ./abis/LiquidityBootstrappingPool.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: SwapFeePercentageChanged(uint256)
          handler: handleSwapFeePercentageChange
        - event: SwapEnabledSet(bool)
          handler: handleSwapEnabledSet
        - event: GradualWeightUpdateScheduled(uint256,uint256,uint256[],uint256[])
          handler: handleGradualWeightUpdateScheduled
  - kind: ethereum/contract
    name: StablePhantomPool
    network: optimism
    source:
      abi: StablePhantomPool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolController.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
        - PoolShares
        - UserShare
        - Amp
        - GradualAmpUpdate
        - PriceRateProvider
      abis:
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: StablePool
          file: ./abis/StablePool.json
        - name: MetaStablePool
          file: ./abis/MetaStablePool.json
        - name: StablePhantomPool
          file: ./abis/StablePhantomPool.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: SwapFeePercentageChanged(uint256)
          handler: handleSwapFeePercentageChange
        - event: AmpUpdateStarted(uint256,uint256,uint256,uint256)
          handler: handleAmpUpdateStarted
        - event: AmpUpdateStopped(uint256)
          handler: handleAmpUpdateStopped
        - event: TokenRateProviderSet(indexed address,indexed address,uint256)
          handler: handlePriceRateProviderSet
        - event: TokenRateCacheUpdated(indexed address,uint256)
          handler: handlePriceRateCacheUpdated
  - kind: ethereum/contract
    name: LinearPool
    network: optimism
    source:
      abi: LinearPool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/poolController.ts
      entities:
        - Balancer
        - GlobalVaultMetric
        - Pool
        - PoolToken
        - PoolAddressToId
        - SwapConfig
        - TokenWeight
        - GlobalPoolMetric
        - Token
        - PoolShares
        - UserShare
        - PriceRateProvider
        - LinearPoolTarget
      abis:
        - name: WeightedPool
          file: ./abis/WeightedPool.json
        - name: MetaStablePool
          file: ./abis/MetaStablePool.json
        - name: LinearPool
          file: ./abis/LinearPool.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: SwapFeePercentageChanged(uint256)
          handler: handleSwapFeePercentageChange
        - event: TargetsSet(indexed address,uint256,uint256)
          handler: handleTargetsSet
  - kind: ethereum/contract
    name: SingleTokenRewarder
    network: optimism
    source:
      abi: SingleTokenRewarder
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/masterchef-single-token-rewarder.ts
      entities:
        - MasterChef
        - Farm
        - StakedPoolShares
        - LifetimeFarmMetric
        - DailyFarmMetric
        - MasterChefFarmEmissionProvider
        - MasterChefFarmRewarderEmissionProvider
        - MasterChefRewardToken
        - ClaimedEmission
        - StakedPoolShares
      abis:
        - name: SingleTokenRewarder
          file: ./abis/SingleTokenRewarder.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: MasterChef
          file: ./abis/MasterChef.json
      eventHandlers:
        - event: LogRewardPerSecond(uint256)
          handler: logRewardPerSecond
        - event: LogOnReward(indexed address,indexed uint256,uint256,indexed address)
          handler: logOnReward
  - kind: ethereum/contract
    name: MultiTokenRewarder
    network: optimism
    source:
      abi: MultiTokenRewarder
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/masterchef-multitoken-rewarder.ts
      entities:
        - MasterChef
        - Farm
        - StakedPoolShares
        - LifetimeFarmMetric
        - DailyFarmMetric
        - MasterChefFarmEmissionProvider
        - MasterChefFarmRewarderEmissionProvider
        - MasterChefRewardToken
        - ClaimedEmission
        - StakedPoolShares
      abis:
        - name: MultiTokenRewarder
          file: ./abis/MultiTokenRewarder.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: MasterChef
          file: ./abis/MasterChef.json
      eventHandlers:
        - event: LogRewardsPerSecond(address[],uint256[])
          handler: logRewardsPerSecond
        - event: LogOnReward(indexed address,indexed uint256,address,uint256,indexed address)
          handler: logOnReward
  - kind: ethereum/contract
    name: RewardsOnlyGauge
    # prettier-ignore
    network: optimism
    source:
      abi: RewardsOnlyGauge
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/gauge-emissions.ts
      entities:
        - Farm
        - StakedPoolShares
        - LifetimeFarmMetric
        - DailyFarmMetric
        - GaugeStreamer
        - GaugeEmissionProvider
        - GaugeChefRewardToken
        - ClaimedEmission
        - StakedPoolShares
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: RewardsOnlyGauge
          file: ./abis/RewardsOnlyGauge.json
        - name: LiquidityGauge
          file: ./abis/LiquidityGaugeV5.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
  - kind: ethereum/contract
    name: ChildChainStreamer
    # prettier-ignore
    network: optimism
    source:
      abi: ChildChainStreamer
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/gauge-emissions.ts
      entities:
        - Farm
        - StakedPoolShares
        - LifetimeFarmMetric
        - DailyFarmMetric
        - GaugeStreamer
        - GaugeEmissionProvider
        - GaugeChefRewardToken
        - ClaimedEmission
        - StakedPoolShares
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChildChainStreamer
          file: ./abis/ChildChainStreamer.json
      eventHandlers:
        - event: RewardDistributorUpdated(indexed address,address)
          handler: handleRewardDistributorUpdated
